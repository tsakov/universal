var transformPayload = function (preferences) {
    var result = {
        prefix: "deps/components/uiOptions/html/",
        distributeOptions: [{
            target: "{that > templateLoader}.options.templates",
            record: {
                uiOptions: "deps/pcp_templates/pcpMainDialog.html"
            }
        }, {
            target: "{that > uiOptionsLoader > uiOptions}",
            record: {
                selectors: {},
                components: {}
            }
        }]
    };

    for (var i = 0; i < preferences.length; ++i) {
        var currentPreference = preferences[i];
        var selector = currentPreference.preferenceName.split(" ").join("");

        result.distributeOptions[0].record[selector] = "content/temp/" + currentPreference.preferenceName + ".html";
        result.distributeOptions[1].record.selectors[selector] = "pcp-" + currentPreference.preferenceName.split(" ").join("");
        result.distributeOptions[1].record.components[selector] = {
            type: "gpii.pcp.genericCheckbox",
            container: "{uiOptions}.dom.genericCheckbox",
            createOnEvent: "onUIOptionsMarkupReady",
            options: currentPreference
        }
    }

    return result;
};


var uiOptions_init = function (displayedPreferences) {
    fluid.staticEnvironment.gpiiPcp = fluid.typeTag("gpii.pcp");

    fluid.pageEnhancer({});

    var uiConfig = transformPayload(displayedPreferences);

    fluid.uiOptions.fullNoPreview("#pcpMainSettings", uiConfig);

    fluid.demands("fluid.uiOptions.textControls", ["fluid.uiOptions", "gpii.pcp"], {
        funcName: "fluid.emptySubcomponent"
    });

    fluid.demands("fluid.uiOptions.layoutControls", ["fluid.uiOptions", "gpii.pcp"], {
        funcName: "fluid.emptySubcomponent"
    });

    fluid.demands("fluid.uiOptions.linksControls", ["fluid.uiOptions", "gpii.pcp"], {
        funcName: "fluid.emptySubcomponent"
    });
};