(function ($, fluid) {       

    /****************************************************************
     * Sample Prefs Panel showing rendering of each type of control *
     ****************************************************************/
    fluid.defaults("gpii.pcp.genericDropdown", {
        gradeNames: ["fluid.uiOptions.prefPanel", "autoInit"],
        preInitFunction: "gpii.pcp.genericDropdown.genericDropdownPreInit",

        strings: {},
        controlValues: {},
        selectors: {},
        defaultModel: {},
        produceTree: "gpii.pcp.genericDropdown.produceTree",
        resources: {
            template: "{templateLoader}.resources.genericDropdown"
        },

        id: null,   // or "preferenceID"
        preferenceName: null,
        preferenceDescription: null,
        valueSpace: null,
        value: false
    });

    gpii.pcp.genericDropdown.genericDropdownPreInit = function (that) {
        var selectors = {};
        var id = that.options.id = that.options.preferenceName.split(" ").join("");
        //var id = that.options.id;
        var newSelector = ".pcp-" + that.options.preferenceName.split(" ").join("");

        selectors[id] = newSelector;
        selectors[id + "Label"] = newSelector + "Label";
        selectors[id + "Description"] = newSelector + "Description";

        that.options.selectors = selectors;
        that.options.defaultModel[id] = that.options.value;
        that.options.strings = { id: that.options.valueSpace };
        that.options.controlValues = { id: that.options.valueSpace };
    };

    gpii.pcp.genericDropdown.produceTree = function (that) {
        var tree = {};
        for (var item in that.model.selections) {
            //if (item === "genericCheckbox") { 
            if (item === that.options.id) {
                tree[item] = {
                    optionnames: "${labelMap." + item + ".names}",
                    optionlist: "${labelMap." + item + ".values}",
                    selection: "${selections." + item + "}"
                };
                //tree[item] = "${selections." + item + "}";
                tree[item + "Label"] = that.options.preferenceName;
                tree[item + "Description"] = that.options.preferenceDescription;
            }
        }
alert(JSON.stringify(tree, null, 4))
        return tree;
    };

})(jQuery, fluid);
