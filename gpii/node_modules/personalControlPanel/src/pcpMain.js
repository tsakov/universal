(function () {

    "use strict";

    var fluid = require("infusion"),
        gpii = fluid.registerNamespace("gpii"),
        fs = require("fs"),
        spawn = require("child_process").spawn;

    gpii.requests.request.handler.pcpMain = function(requestProxy, token, that) {
        that.options.token = token;
        //requestProxy.events.onSuccess.fire(fs.readFileSync(__dirname + "/content/index_old.html").toString());

        // if using appjs:
        that.options.pcpInstance = spawn("node", ["--harmony", __dirname + "/app.js"]);

        requestProxy.events.onSuccess.fire("personal control panel for " + token + " started\n" + __dirname);
    };

})();
